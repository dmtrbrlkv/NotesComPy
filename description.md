# Библиотека NotesComPy

Библиотека позволяет взаимодействовать с объектами Notes через COM

## Ограничения
Взаимодействие реализовано через COM, поэтому работает только под Windows. Также необходим установленный клиент IBM Lotus Notes (HCL Notes). Подлючение идет от имени пользователя, указанного в файле конфигурации Notes (notes.ini). Также возможна работа от текущего залогиненного пользователя.

## Доступные классы
Реализованы следующие основные классы и их методы:
* NotesSession
* NotesDatabase
* NotesDocument
* NotesView
* NotesDocumentCollection
* NotesACL
* NotesACLEntry
* NotesAgent
* NotesLog

Для расширенной работы с коллекциям документов реализован класс CustomCollection, позволяющий работать с документами из разных баз и эмулирующий тразакционное сохранение.
Для большинства классов раелизована возможость экспорта данных и другие возможности, изначально отсутвующие в классах Notes.


## Работа с библиотекой
Разберем основный возможности библиотеки на примере работы с простой notes базой IT crowd. База состоит из двух справочников - Levels и  Languages и основной карточки Person.

Справочник языков программирования:
![Языки программирования](img/languages.png)

Справочник уровней:
![Уровни](img/levels.png)

Сотрудники:
![Сотрудники](img/persons.png)

Для сотрудника можно указать ФИО и телефон и выбрать из справочника языки, которыми он владеет и его уровень:
![Сотрудник](img/person.png)

В справочниках есть кнопка **Update person**, запускающая агент, обновляющий в карточках сотрудников измененное название языка или уровня.

#### Инициализация
Прежде всего необходимо проинициализировать сессию, передав в нее пароль от текущего user.id:
```
from notescompy import init_session, open_database
s = session.init_session("python")
```
Можно посмотреть текущего пользователя:

```
print(s.UserName)
```

> CN=Python/O=PyLN

#### Работа с базой
Теперь можно получить базу, передав сервер и путь:
```
db = open_database('PyLN', 'itcrowd.nsf')
```

Посмотрим размер базы и ее название:

```
print(db.title, db.size)
```
> IT Crowd 884736.0

Из базы можно получить коллекцию всех документов, ACL, получить конкретный документ или создать новый, получить представление и агент:
```
all_col = db.all_documents
acl = db.acl
doc = db.get_document_by_unid("9A899214038E229843258541003BFFDB")
new_doc = db.create_document()
view = db.get_view("Levels")
agent = db.get_agent("UpdatePerson")
```
Работу с получившимися объектами разберем в соотвествующий разделах.

Также доступен поиск по формуле. Обычно вторым и третьим параметрами мы передаем Nothing и 0, поэтому эти значения заданы по умолчанию, достаточно задать только формулу.

Надем всех сотрудников, у которых в имени встречается John:

```
col = db.search("@contains(FullName;'John'")
```

#### Документ
Для начала возьмем документ из примера с базой:
```
from notescompy import init_session, open_database
s = init_session("python")
db = open_database('PyLN', 'itcrowd.nsf')
doc = db.get_document_by_unid("9A899214038E229843258541003BFFDB")
```
Посмотрим его форму:
````
print(doc.get_item_value("Form"))
````
> ['Person']

Как вы могли заметить, наименование методов слегка не привычно, в LotusScript мы привыкли к doc.GetItemValue, однако это не соответствует требованиям PEP8. Тем не менее реализована возможносты обращаться к методам и свойстам с привычными наименованиями.
Посмотрим значение поля Level LotusScript-стиле
```
print(doc.GetItemValue("Level"))
```
> ['Senior']

Как известно, GetItemValue возвращает массив значений (список в Python), даже если значение в поле одно и мы постоянно берем от него нулевое значение
```
print(doc.get_item_value("Level")[0])
```
> Senior

Но это же Python, должен быть сахар и это метод get_item_value0
```
print(doc.get_item_value0("Level"))
```
> Senior

В обоих случаях возвращается не список, а строка